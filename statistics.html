<!doctype html>
<html>
<head>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script>window.$ = window.jQuery = require('./jquery.min.js')</script>
    <script>require('./bootstrap.min.js')</script>
    <style>

    </style>
</head>
<body>
    <div id="header">
        <h1>
            扶贫攻坚工作计划
        </h1>
    </div>
    <div id="container">
        <div id="menu">
            <div class="panel-group" role="tablist" aria-multiselectable="true">
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#accordion" aria-expanded="true" aria-controls="collapseOne">
                            </a>
                        </h4>
                    </div>
                    <div class="panel-collapse collapse" role="tabpanel">
                        <div class="panel-body">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="content">
            <div class="paper" id="jbqk">
                <h2 class="text-center">全乡贫困户基本情况</h2>
                <hr>
                <table id="jbqk_tb" class="table table-bordered table-striped">
                    <tr>
                        <th>村别</th><th>贫困户数</th><th>一般贫困户</th><th>低保户</th><th>一般疾病</th><th>大病</th><th>残疾</th><th>中共党员</th><th>文盲</th><th>小学</th><th>初中</th><th>高中</th><th>大专以上</th>
                    </tr>
                </table>
            </div>

            <div class="paper" id="tpjh">
                <h2 class="text-center">全乡总体预计脱贫计划汇总</h2>
                <hr>
                <table id="tpjh_tb" class="table table-bordered table-striped">
                    <tr><th>村别</th><th>2016 户数</th><th>2017 户数</th><th>2018 户数</th><th>2019 户数</th><th>合计户数</th></tr>
                </table>
            </div>

            <div class="paper" id="zpyy">
                <h2 class="text-center">全乡总体致贫原因汇总</h2>
                <hr>
                <table id="zpyy_tb" class="table table-bordered table-striped">
                    <tr><th>村别</th><th>因病</th><th>因残</th><th>因学</th><th>缺土地</th><th>缺水</th><th>缺技术</th><th>缺劳力</th><th>缺资金</th><th>交通条件落后</th><th>自身发展动力不足</th><th>因灾</th><th>因婚</th></tr>
                </table>
            </div>

            <div class="paper" id="lwsc">
                <h2 class="text-center">全乡劳务输出汇总</h2>
                <hr>
                <table id="lwsc_tb" class="table table-bordered table-striped">
                    <tr><th>村别</th><th>临时外出</th><th>常年外出</th><th>维修</th><th>翻房</th></tr>
                </table>
            </div>
            
            <div class="paper" id="srqk">
                <h2 class="text-center">全乡总体收入汇总</h2>
                <hr>
                <table id="srqk_tb" class="table table-bordered table-striped">
                    <tr><th>村别</th><th>户主姓名</th><th>打工收入</th><th>年领取低保金</th><th>在校生资助金</th><th>领取捐助资金</th><th>生产经营性收入</th><th>生态补偿金</th><th>土地流转收入</th><th>计划生育金</th><th>养老保险金</th><th>财产性收入</th><th>其他收入</th><th>合计</th><th>生产经营性支出</th><th>教育支出</th><th>医疗支出</th><th>婚嫁支出</th><th>其他支出</th><th>合计</th></tr>
                </table>
            </div>

            <div class="paper" id="yjtp">
                <h2 class="text-center">预计脱贫名单</h2>
                <hr>
                <table id="yjtp_tb" class="table table-bordered table-striped">
                </table>
            </div>

        </div>
    </div>
    <div id="footer">
        <div id="home">
            <a href="index.html"><button class="btn btn-primary">
                <span class="glyphicon glyphicon-home"></span>
            </button></a>
        </div>
        <div id="nav">
            <a href="baseinfo.html"><button class="btn btn-success">基本情况介绍</button></a>
            <a href="statistics.html"><button class="btn btn-success" disabled="disabled">扶贫攻坚工作计划</button></a>
            <a href="bignews.html"><button class="btn btn-success">扶贫攻坚大事记</button></a>
        </div>
        <div id="exit">
            <button class="btn btn-danger">
                <span class="glyphicon glyphicon-off"></span>
            </button>
        </div>
    </div>



    <script>
        var sqlite3 = require('sqlite3')
        var db = new sqlite3.Database('data.db');

        var town = $('#menu').find('.panel-group');
        var collapse = town.find('.panel').clone();
        town.find('.collapse').attr('id', 'town-0');
        town.find('a').attr('href', '#town-0');
        town.find('a').text('小徳营子乡');
        town.find('div.panel-body').html('<div class="panel-group" role="tablist" aria-multiselectable="true"></div>');
        
        var town_ul = $('<ul></ul>');
        var jbqk_li = $('<li><a href="#">全乡贫困户基本情况</a></li>');
        var tpjh_li = $('<li><a href="#">全乡总体脱贫计划汇总</a></li>');
        var zpyy_li = $('<li><a href="#">全乡总体致贫原因汇总</a></li>');
        var lwsc_li = $('<li><a href="#">全乡总体劳务输出汇总</a></li>');
        var srqk_li = $('<li><a href="#">全乡总体收入情况汇总</a></li>');

        town_ul.append(jbqk_li);
        town_ul.append(tpjh_li); town_ul.append(zpyy_li); town_ul.append(lwsc_li); town_ul.append(srqk_li);
        town.find('.panel-group').append(town_ul);

        db.all('select * from `village`', function(err, rows) {
            if(rows) {
                rows.forEach(function(value) {
                    var village = collapse.clone();
                    village.find('.collapse').attr('id', 'village-' + value.name);
                    village.find('a').attr('href', '#village-' + value.name);
                    village.find('a').text(value.name);
                    village.find('div.panel-body').html('<ul village="' + value.name + '"><li class="tuopinmingdan" nianfen="2016"><a href="#">2016 年预计脱贫名单</a></li><li class="tuopinmingdan" nianfen="2017"><a href="#">2017 年预计脱贫名单</a></li><li class="tuopinmingdan" nianfen="2018"><a href="#">2018 年预计脱贫名单</a></li class="tuopinmingdan" nianfen="2019"><a href="#"><li>2019 年预计脱贫名单</a></li></ul>')
                        
                    town.find('.panel-group').append(village);
                });
            }
            
            $('.tuopinmingdan').click(function() {
            $('.paper').hide();
                $('#yjtp').show();
                yjtp_tb = $('#yjtp_tb');
                yjtp_tb.empty();
                yjtp_tb.append($('<tr><th>姓名</th><th>村别</th><th>预计脱贫年份</th></tr>'));

                db.all("select * from `person` where `cun`=? and `yujituopinnianfen`=?", $(this).parent().attr('village'), $(this).attr('nianfen'), function(err, rows) {
                    rows.forEach(function(row) {
                        var tr = $('<tr><td>' + row.cun + '</td><td>' + row.xingming + '</td><td>' + row.yujituopinnianfen + '</td></tr>');
                        yjtp_tb.append(tr);
                    });
                });
            });
        });
        

        /** 基本情况统计 **/
        var jbqk_hz = [];
        db.all('select * from `village`', function(err, rows) {
            rows.forEach(function(value) {
                var tags = ["'贫困户数'='贫困户数'", "`pinkunhushuxing`='一般贫困户'", "`pinkunhushuxing`='低保户'", "`jiankangqingkuang`='一般疾病'", "`jiankangqingkuang`='大病'", "`jiankangqingkuang`='残疾'", "`zhengzhimianmao`='中共党员'", "`wenhuachengdu`='文盲'", "`wenhuachengdu`='小学'", "`wenhuachengdu`='初中'", "`wenhuachengdu`='高中'", "`wenhuachengdu`='大专以上'"]
                jbqk_hz[value.name] = []
                tags.forEach(function(tag) {
                    db.get("select count(*) num from `person` where `cun`='" + value.name + "' and " + tag, function(err, row) {
                        jbqk_hz[value.name][tag.split("'")[1]] = row.num;
                    });
                });
            });
        });

        jbqk_li.click(function() {
            $('.paper').hide();
            $('#jbqk').show();
            var jbqk_tb = $('#jbqk_tb');
            if(jbqk_tb.find('tr').length > 1)
                return ;
                var tags = ["'贫困户数'='贫困户数'", "`pinkunhushuxing`='一般贫困户'", "`pinkunhushuxing`='低保户'", "`jiankangqingkuang`='一般疾病'", "`jiankangqingkuang`='大病'", "`jiankangqingkuang`='残疾'", "`zhengzhimianmao`='中共党员'", "`wenhuachengdu`='文盲'", "`wenhuachengdu`='小学'", "`wenhuachengdu`='初中'", "`wenhuachengdu`='高中'", "`wenhuachengdu`='大专以上'"]
            for(var k1 in jbqk_hz) {
                var tr = $('<tr><td>' + k1 + '</td></tr>');
                for(var i = 0; i < tags.length; i++) {
                    k2 = tags[i].split("'")[1];
                    tr.append($('<td>' + jbqk_hz[k1][k2] + '</td>'));
                }
                jbqk_tb.append(tr);
            }
        });

        /** 脱贫计划统计 */
        var tpjh_hz = [];
        db.all('select * from `village`', function(err, rows) {
            rows.forEach(function(value) {
                var tags = ['2016', '2017', '2018', '2019']
                tpjh_hz[value.name] = []
                tags.forEach(function(tag) {
                    db.get("select count(*) num from `person` where `cun`='" + value.name + "' and `yujituopinnianfen`='" + tag + "'", function(err, row) {
                        tpjh_hz[value.name][tag] = row.num;
                    });
                });
            });
        });


        tpjh_li.click(function() {
            $('.paper').hide();
            $('#tpjh').show();
            var tpjh_tb = $('#tpjh_tb');
            if(tpjh_tb.find('tr').length > 1)
                return ;
            for(var k1 in tpjh_hz) {
                var tr = $('<tr><td>' + k1 + '</td></tr>');
                var sum = 0;
                for(var k2 in tpjh_hz[k1]) {
                    tr.append($('<td>' + tpjh_hz[k1][k2] + '</td>'));
                    sum += parseInt(tpjh_hz[k1][k2]);
                }
                tr.append($('<td>' + sum + '</td>'));
                tpjh_tb.append(tr);
            }
        });

        /** 全乡总体致贫原因汇总 */
        var zpyy_hz = [];
        db.all('select * from `village`', function(err, rows) {
            rows.forEach(function(value) {
                var tags = ['因病', '因残', '因学', '缺土地', '缺水', '缺技术', '缺劳力', '缺资金', '交通条件落后', '自身发展动力不足', '因灾', '因婚']
                zpyy_hz[value.name] = []
                tags.forEach(function(tag) {
                    db.get("select count(*) num from `person` where `cun`='" + value.name + "'and `zhipinyuanyin`='" + tag + "'", function(err, row) {
                        zpyy_hz[value.name][tag] = row.num;
                    });
                })
            })
        })

        zpyy_li.click(function() {
            $('.paper').hide();
            $('#zpyy').show();
            var zpyy_tb = $('#zpyy_tb');
            if(zpyy_tb.find('tr').length > 1)
                return ;
            var tags = ['因病', '因残', '因学', '缺土地', '缺水', '缺技术', '缺劳力', '缺资金', '交通条件落后', '自身发展动力不足', '因灾', '因婚']
            for(var k1 in zpyy_hz) {
                console.log(k1);
                var tr = $('<tr><td>' + k1 + '</td></tr>');
                for(var i = 0; i < tags.length; i++) {
                    tr.append($('<td>' + zpyy_hz[k1][tags[i]] + '</td>'));
                }
                zpyy_tb.append(tr);
            }
        });

        /** 劳务输出汇总 **/
        var lwsc_hz = [];
        db.all('select * from `village`', function(err, rows) {
            rows.forEach(function(value) {
                var tags = ["`laowushuchu`='临时外出'", "`laowushuchu`='常年外出'", "`weifanggaizaojihua`='维修'", "`weifanggaizaojihua`='翻房'"]
                lwsc_hz[value.name] = []
                tags.forEach(function(tag) {
                    db.get("select count(*) num from `plan`, `person` where person.id=plan.person_id and `cun`='" + value.name + "' and `nianfen`='2016' and " + tag, function(err, row) {
                        lwsc_hz[value.name][tag.split("'")[1]] = row.num;
                    });
                })
            })
        })

        lwsc_li.click(function() {
            $('.paper').hide();
            $('#lwsc').show();
            var lwsc_tb = $('#lwsc_tb');
            if(lwsc_tb.find('tr').length > 1)
                return ;
            var tags = ['临时外出', '常年外出', '维修', '翻房']
            for(var k1 in lwsc_hz) {
                var tr = $('<tr><td>' + k1 + '</td></tr>');
                for(var i = 0; i < tags.length; i++) {
                    tr.append($('<td>' + lwsc_hz[k1][tags[i]] + '</td>'));
                }
                lwsc_tb.append(tr);
            }
        });

        /** 收入情况汇总 **/
        var srqk_hz = [];
        db.all("select * from `plan`, `person` where person.id=plan.person_id and `nianfen`='2016'", function(err, rows) {
            rows.forEach(function(row) {
                srqk_hz.push(row);
                console.log(row.cun);
            });
        });

        srqk_li.click(function() {
            $('.paper').hide();
            $('#srqk').show();
            var srqk_tb = $('#srqk_tb');
            if(srqk_tb.find('tr').length > 1)
                return ;
            for(var i = 0; i < srqk_hz.length; i++) {
                srqk = srqk_hz[i];
                var tr = $('<tr><td>' + srqk['cun'] + '</td><td>' + srqk['xingming'] + '</td></tr>');
                var sum = 0;
                var tags = ['dagongshouru', 'nianlingqudibaojin', 'zaixiaoshengnianzizhujin', 'lingqujuanzhuzijin', 'shengchanjingyingxingshouru', 'shengtaibuchangjin', 'tudiliuzhuanshouru', 'jihuashengyujin', 'yanglaobaoxianjin', 'caichanxingshouru', 'qitashouru']
                for(var tag in tags) {
                    tr.append($('<td>' + (srqk[tag] || 0) + '</td>'));
                    sum += parseInt(srqk[tag] || 0);
                    srqk_tb.append(tr);
                }
                tr.append($('<td>' + sum + '</td>'));
                srqk_tb.append(tr);
                sum = 0;
                tags = ['shengchanjingyingxingzhichu', 'jiaoyuzhichu', 'yiliaozhichu', 'hunjiazhichu', 'qitazhichu']
                for(var tag in tags) {
                    tr.append($('<td>' + (srqk[tag] || 0) + '</td>'));
                    sum += parseInt(srqk[tag] || 0);
                    srqk_tb.append(tr);
                }
                tr.append($('<td>' + sum + '</td>'));
                srqk_tb.append(tr);
            }

        });

        /** 各村预计脱贫名单 **/
        
        $('.tuopinmingdan').click(function() {
            console.log('haha');
            //console.log($(this).attr('nianfen'));
        });

        $('.paper').hide();

    </script>
</body>
</html>
























